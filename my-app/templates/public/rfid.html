{% extends 'public/base_cpanel.html' %}
{% block body %}
<div class="card content_consignaciones" style="border-radius: 0px !important">
  <section id="datosRFID">
    <h2 class="text-center mt-5 mb-5">
      Registro de Tarjetas RFID
      <hr />
    </h2>

    <!-- Botón para generar Excel (solo visible para rol 1) -->
    {% if dataLogin.rol == 1 %}
    <div class="text-center mb-4">
      <button id="btnExportarExcel" class="btn" style="background-color: #1e88e5; border-color: #1e88e5; color: white;">
        Generar Excel
      </button>
    </div>
    {% endif %}

    <!-- Tabla de registros RFID -->
    <div class="table-responsive text-nowrap">
      <table class="table table-hover" id="tablaRFID">
        <thead>
          <tr style="background-color: #ddd">
            <th>Cédula</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            {% if dataLogin.rol == 1 %}
            <th>UID Tarjeta</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for registro in datos_rfid %}
          <tr>
            <td>{{ registro.cedula }}</td>
            <td>{{ registro.nombre if registro.nombre else 'Sin Nombre' }}</td>
            <td>{{ registro.apellido if registro.apellido else 'Sin Apellido' }}</td>
            <td>{{ registro.fecha }}</td>
            <td>{{ registro.hora }}</td>
            <td class="fw-bold text-center">
              <span {% if registro.estado == 'Permitido' %} style="color: green;" 
                    {% elif registro.estado == 'Denegado' %} style="color: red;" 
                    {% else %} style="color: gray;" {% endif %}>
                {{ registro.estado }}
              </span>
            </td>
            {% if dataLogin.rol == 1 %}
            <td>
              <div class="input-group">
                <input type="password" class="form-control uid-tarjeta" value="{{ registro.uid_tarjeta }}" readonly style="max-width: 120px;">
                <button class="btn btn-outline-secondary toggle-uid" type="button">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <div class="d-flex justify-content-center mt-4">
      <nav>
        <ul class="pagination">
          {% if pagina_actual > 1 %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('rfid', pagina=1) }}">Primero</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="{{ url_for('rfid', pagina=pagina_actual-1) }}">Anterior</a>
          </li>
          {% endif %}
          
          <li class="page-item disabled">
            <span class="page-link">Página {{ pagina_actual }} de {{ total_paginas }}</span>
          </li>

          {% if pagina_actual < total_paginas %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('rfid', pagina=pagina_actual+1) }}">Siguiente</a>
          </li>
          <li class="page-item">
            <a class="page-link" href="{{ url_for('rfid', pagina=total_paginas) }}">Último</a>
          </li>
          {% endif %}
        </ul>
      </nav>
    </div>

  </section>
</div>
{% endblock %}

{% block customJS %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".toggle-uid").forEach(button => {
      button.addEventListener("click", function () {
        let input = this.previousElementSibling;
        let icon = this.querySelector("i");
        if (input.type === "password") {
          input.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          input.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      });
    });

    {% if dataLogin.rol == 1 %}
    document.getElementById("btnExportarExcel").addEventListener("click", function () {
      alert("Función de exportación en desarrollo");
    });
    {% endif %}
  });
</script>
{% endblock %}
