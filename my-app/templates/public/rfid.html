{% extends 'public/base_cpanel.html' %}

{% block title %}Monitor de RFID | Sensor Data{% endblock %}

{% block body %}
<div class="card content_consignaciones" style="border-radius: 0px !important">
  <section id="datosRFID">
    <h2 class="text-center mt-5 mb-5">
      Registro de Tarjetas RFID
      <hr />
    </h2>

    <div class="table-responsive text-nowrap">
      <table class="table table-hover">
        <thead>
          <tr style="background-color: #ddd">
            <th>CÃ©dula</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Fecha</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>UID Tarjeta</th>
          </tr>
        </thead>
        <tbody>
          {% for registro in datos_rfid %}
          <tr>
            <td>{{ registro.cedula }}</td>
            <td>{{ registro.nombre if registro.nombre else 'Sin Nombre' }}</td>
            <td>{{ registro.apellido if registro.apellido else 'Sin Apellido' }}</td>
            <td>{{ registro.fecha }}</td>
            <td>{{ registro.hora }}</td>
            <td class="fw-bold text-center">
              <span {% if registro.estado == 'Permitido' %} style="color: green;" 
                    {% elif registro.estado == 'Denegado' %} style="color: red;" 
                    {% else %} style="color: gray;" {% endif %}>
                {{ registro.estado }}
              </span>
            </td>
            <td>
              <div class="input-group">
                <input type="password" class="form-control uid-tarjeta" value="{{ registro.uid_tarjeta }}" readonly style="max-width: 120px;">
                <button class="btn btn-outline-secondary toggle-uid" type="button">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock %}

{% block customJS %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".toggle-uid").forEach(button => {
      button.addEventListener("click", function () {
        let input = this.previousElementSibling;
        let icon = this.querySelector("i");
        
        if (input.type === "password") {
          input.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          input.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      });
    });
  });

  // Recarga los datos cada minuto
  setInterval(function() {
    location.reload();
  }, 60000);
</script>
{% endblock %}
